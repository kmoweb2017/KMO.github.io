<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏¥‡∏ß ‚Äî KMO RACK BAR CUSTOM</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg:        #111111;
      --surface:   #1a1a1a;
      --surface2:  #222222;
      --accent:    #e8b84b;
      --accent2:   #c9972d;
      --text:      #f0f0f0;
      --text-muted:#888;
      --green:     #2ecc71;
      --yellow:    #f39c12;
      --red:       #e74c3c;
      --closed:    #333;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Sarabun', sans-serif;
      min-height: 100vh;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #1a1a1a 0%, #222 100%);
      border-bottom: 2px solid var(--accent);
      padding: 20px 16px;
      text-align: center;
    }
    .header-logo {
      font-family: 'Kanit', sans-serif;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 4px;
      color: var(--accent);
      text-transform: uppercase;
      margin-bottom: 4px;
    }
    .header-title {
      font-family: 'Kanit', sans-serif;
      font-size: 22px;
      font-weight: 700;
      color: var(--text);
    }
    .header-sub {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* Container */
    .container {
      max-width: 480px;
      margin: 0 auto;
      padding: 16px;
    }

    /* Calendar Nav */
    .cal-nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 20px 0 16px;
    }
    .cal-nav button {
      background: var(--surface2);
      border: 1px solid #333;
      color: var(--text);
      width: 40px;
      height: 40px;
      border-radius: 8px;
      font-size: 18px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .cal-nav button:hover { background: var(--accent); color: #000; }
    .cal-month {
      font-family: 'Kanit', sans-serif;
      font-size: 18px;
      font-weight: 600;
      color: var(--accent);
    }

    /* Calendar Grid */
    .cal-grid {
      background: var(--surface);
      border-radius: 16px;
      overflow: hidden;
      border: 1px solid #2a2a2a;
    }

    .cal-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      background: var(--surface2);
      border-bottom: 1px solid #2a2a2a;
    }
    .cal-weekday {
      text-align: center;
      padding: 10px 4px;
      font-family: 'Kanit', sans-serif;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-muted);
    }
    .cal-weekday.sun { color: #e74c3c88; }
    .cal-weekday.tue { color: #e74c3c88; }

    .cal-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background: #2a2a2a;
    }

    .cal-day {
      background: var(--surface);
      min-height: 72px;
      padding: 6px 4px;
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      transition: background 0.15s;
      position: relative;
    }
    .cal-day:hover:not(.disabled):not(.empty) {
      background: #252525;
    }
    .cal-day.empty {
      background: var(--bg);
      cursor: default;
    }
    .cal-day.disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }
    .cal-day.today .day-num {
      background: var(--accent);
      color: #000;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .cal-day.past {
      opacity: 0.35;
      cursor: not-allowed;
    }

    .day-num {
      font-family: 'Kanit', sans-serif;
      font-size: 14px;
      font-weight: 600;
      color: var(--text);
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 4px;
    }

    .day-status {
      font-size: 10px;
      font-family: 'Sarabun', sans-serif;
      text-align: center;
      line-height: 1.3;
      font-weight: 600;
    }

    /* Status colors */
    .status-open   .day-status { color: var(--green); }
    .status-low    .day-status { color: var(--yellow); }
    .status-full   .day-status { color: var(--red); }

    .status-full   { background: #2a1515 !important; }

    /* Dot indicator */
    .day-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      margin-top: 3px;
    }
    .status-open   .day-dot { background: var(--green); }
    .status-low    .day-dot { background: var(--yellow); }
    .status-full   .day-dot { background: var(--red); }

    /* Legend */
    .legend {
      display: flex;
      gap: 16px;
      justify-content: center;
      margin: 16px 0;
      flex-wrap: wrap;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--text-muted);
    }
    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--text-muted);
      font-size: 14px;
    }
    .spinner {
      width: 32px;
      height: 32px;
      border: 3px solid #333;
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 12px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Info box */
    .info-box {
      background: var(--surface);
      border: 1px solid #2a2a2a;
      border-radius: 12px;
      padding: 14px 16px;
      margin-top: 16px;
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.7;
    }
    .info-box strong { color: var(--accent); }

    /* Book button */
    .btn-book {
      display: block;
      width: 100%;
      padding: 16px;
      background: var(--accent);
      color: #000;
      font-family: 'Kanit', sans-serif;
      font-size: 16px;
      font-weight: 700;
      text-align: center;
      border-radius: 12px;
      text-decoration: none;
      margin-top: 20px;
      transition: background 0.2s, transform 0.1s;
    }
    .btn-book:hover {
      background: var(--accent2);
      transform: translateY(-1px);
    }

    /* Error */
    .error-box {
      background: #2a1515;
      border: 1px solid var(--red);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      color: #e74c3c;
      font-size: 14px;
      margin: 20px 0;
    }
  </style>
</head>
<body>

<div class="header">
  <div class="header-logo">KMO RACK BAR CUSTOM</div>
  <div class="header-title">üìÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏¥‡∏ß‡∏ß‡πà‡∏≤‡∏á</div>
  <div class="header-sub">‡∏î‡∏π‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
</div>

<div class="container">

  <!-- Legend -->
  <div class="legend">
    <div class="legend-item">
      <div class="legend-dot" style="background:var(--green)"></div>
      <span>‡∏ß‡πà‡∏≤‡∏á 3 ‡∏Ñ‡∏¥‡∏ß</span>
    </div>
    <div class="legend-item">
      <div class="legend-dot" style="background:var(--yellow)"></div>
      <span>‡∏ß‡πà‡∏≤‡∏á 1-2 ‡∏Ñ‡∏¥‡∏ß</span>
    </div>
    <div class="legend-item">
      <div class="legend-dot" style="background:var(--red)"></div>
      <span>‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏Ñ‡∏¥‡∏ß</span>
    </div>
  </div>

  <!-- Calendar Nav -->
  <div class="cal-nav">
    <button id="btn-prev" onclick="changeMonth(-1)">&#8249;</button>
    <div class="cal-month" id="cal-month-label">‚Äî</div>
    <button id="btn-next" onclick="changeMonth(1)">&#8250;</button>
  </div>

  <!-- Calendar -->
  <div class="cal-grid">
    <div class="cal-weekdays">
      <div class="cal-weekday sun">‡∏≠‡∏≤</div>
      <div class="cal-weekday">‡∏à</div>
      <div class="cal-weekday tue">‡∏≠</div>
      <div class="cal-weekday">‡∏û</div>
      <div class="cal-weekday">‡∏û‡∏§</div>
      <div class="cal-weekday">‡∏®</div>
      <div class="cal-weekday">‡∏™</div>
    </div>
    <div class="cal-days" id="cal-days">
      <div class="loading">
        <div class="spinner"></div>
        ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏¥‡∏ß...
      </div>
    </div>
  </div>

  <!-- Info -->
  <div class="info-box">
    üèçÔ∏è ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î <strong>3 ‡∏Ñ‡∏¥‡∏ß‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô</strong><br/>
    üìÖ ‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡∏¥‡∏î‡∏ó‡∏∏‡∏Å<strong>‡∏ß‡∏±‡∏ô‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£</strong><br/>
    ‚è∞ ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≠‡∏á‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥ <strong>500 ‡∏ö‡∏≤‡∏ó</strong> ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
  </div>

  <!-- Book Button -->
  <a href="project1_booking.html" class="btn-book">
    üìã ‡∏Å‡∏î‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
  </a>

</div>

<script>
  // ===== ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ =====
  const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbywK3CGtpGqT9qrS3dRKGUbAIS-n6dNgujLQO6sJ4SV-eRDvGo7e2amj9gJ2aCgLsSi/exec'; // ‚Üê ‡πÉ‡∏™‡πà URL Apps Script Project 3
  const MAX_PER_DAY = 3;

  // ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏õ‡∏µ ‡∏Ñ.‡∏®.) ‚Äî ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á
  const SPECIAL_HOLIDAYS = [
    '2026-04-11', '2026-04-12', '2026-04-13', '2026-04-14',
    '2026-04-15', '2026-04-16', '2026-04-17', '2026-04-18',
    '2026-04-19', '2026-05-01',
  ];
  // ===================

  let currentYear  = new Date().getFullYear();
  let currentMonth = new Date().getMonth(); // 0-based
  let bookingData  = {}; // { 'YYYY-MM-DD': count }
  let isLoading    = false;

  const THAI_MONTHS = [
    '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå','‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°','‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô','‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°','‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
    '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°','‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô','‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°','‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô','‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
  ];

  // ===== ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Apps Script =====
  async function loadBookings() {
    if (isLoading) return;
    isLoading = true;

    try {
      const url = `${APPS_SCRIPT_URL}?year=${currentYear}&month=${currentMonth + 1}`;
      const res = await fetch(url);
      const data = await res.json();
      bookingData = data.bookings || {};
    } catch (err) {
      console.error('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:', err);
      bookingData = {};
    }

    isLoading = false;
    renderCalendar();
  }

  // ===== ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î =====
  function isHoliday(dateStr) {
    return SPECIAL_HOLIDAYS.includes(dateStr);
  }

  function isTuesday(date) {
    return date.getDay() === 2;
  }

  function toDateStr(date) {
    const y = date.getFullYear();
    const m = String(date.getMonth() + 1).padStart(2, '0');
    const d = String(date.getDate()).padStart(2, '0');
    return `${y}-${m}-${d}`;
  }

  // ===== Render ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô =====
  function renderCalendar() {
    const label = document.getElementById('cal-month-label');
    label.textContent = `${THAI_MONTHS[currentMonth]} ${currentYear + 543}`;

    const container = document.getElementById('cal-days');
    container.innerHTML = '';

    const today    = new Date();
    today.setHours(0, 0, 0, 0);
    const todayStr = toDateStr(today);

    const firstDay = new Date(currentYear, currentMonth, 1);
    const lastDay  = new Date(currentYear, currentMonth + 1, 0);
    const startDow = firstDay.getDay(); // 0=Sun
    const totalDays = lastDay.getDate();

    // Prev month ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏ô
    for (let i = 0; i < startDow; i++) {
      const el = document.createElement('div');
      el.className = 'cal-day empty';
      container.appendChild(el);
    }

    // ‡∏ß‡∏±‡∏ô‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
    for (let d = 1; d <= totalDays; d++) {
      const date    = new Date(currentYear, currentMonth, d);
      const dateStr = toDateStr(date);
      const isPast  = date < today;
      const isTue   = isTuesday(date);
      const isHol   = isHoliday(dateStr);
      const isToday = dateStr === todayStr;
      const count   = bookingData[dateStr] || 0;
      const remain  = MAX_PER_DAY - count;

      const el = document.createElement('div');
      el.className = 'cal-day';

      // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
      let statusText = '';
      let statusClass = '';

      if (isPast) {
        el.classList.add('past', 'disabled');
        statusText = '';
      } else if (isTue || isHol || remain <= 0) {
        statusClass = 'status-full';
        el.classList.add('disabled');
        statusText = '‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏Ñ‡∏¥‡∏ß';
      } else if (remain <= 2) {
        statusClass = 'status-low';
        statusText = '‡∏ß‡πà‡∏≤‡∏á ' + remain + ' ‡∏Ñ‡∏¥‡∏ß';
      } else {
        statusClass = 'status-open';
        statusText = '‡∏ß‡πà‡∏≤‡∏á ' + remain + ' ‡∏Ñ‡∏¥‡∏ß';
      }

      if (statusClass) el.classList.add(statusClass);
      if (isToday) el.classList.add('today');

      // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ß‡∏±‡∏ô
      const numEl = document.createElement('div');
      numEl.className = 'day-num';
      numEl.textContent = d;
      el.appendChild(numEl);

      // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
      if (statusText) {
        const statusEl = document.createElement('div');
        statusEl.className = 'day-status';
        statusEl.textContent = statusText;
        el.appendChild(statusEl);

        // Dot
        if (!isPast && !isTue && !isHol) {
          const dot = document.createElement('div');
          dot.className = 'day-dot';
          el.appendChild(dot);
        }
      }

      container.appendChild(el);
    }

    // ‡∏õ‡∏¥‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
    const now = new Date();
    document.getElementById('btn-prev').disabled =
      currentYear === now.getFullYear() && currentMonth === now.getMonth();
  }

  // ===== ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô =====
  function changeMonth(dir) {
    currentMonth += dir;
    if (currentMonth > 11) { currentMonth = 0; currentYear++; }
    if (currentMonth < 0)  { currentMonth = 11; currentYear--; }
    bookingData = {};
    document.getElementById('cal-days').innerHTML =
      '<div class="loading"><div class="spinner"></div>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';
    loadBookings();
  }

  // ===== ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô =====
  loadBookings();
</script>

</body>
</html>
